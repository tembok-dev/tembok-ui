---
// /packages/tembok/components/src/Button.astro
import { variants, cx } from "./utils/variants";

/**
 * intent: "primary" | "neutral" | "ghost"
 * size: "sm" | "md" | "lg"
 * tone: "default" | "ink" | "red" | "lime" | "cyan"
 * as: "button" | "a" | any tag (default "button")
 */

const cls = variants(
    "inline-flex items-center gap-2 select-none cursor-pointer \
   rounded-lg px-3 py-1.5 text-sm font-medium \
   brightness-90 hover:brightness-100\
   transition-all duration-fast shadow-sm active:animate-press \
   border border-border \
   outline-none focus:outline-none \
   focus-visible:ring-2 focus-visible:ring-fg/30 \
   focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--bg))] \
   ring-transparent ring-offset-transparent",
    {
        intent: {
            primary:
                "bg-primary text-primary-fg border-transparent \
          active:brightness-95 \
         focus-visible:ring-primary/40",

            neutral:
                "bg-bg-light/90 text-fg border-border/60 \
          active:bg-bg/90  \
         focus-visible:ring-fg/30",

            ghost:
                "bg-transparent text-fg border-border \
          active:bg-bg-light/80  \
         focus-visible:ring-fg/25",

            success:
                "bg-success text-success-fg border-transparent \
          active:brightness-95 \
         focus-visible:ring-success/35",

            warning:
                "bg-warning text-warning-fg border-transparent \
          active:brightness-95 \
         focus-visible:ring-warning/35",

            info:
                "bg-info text-info-fg border-transparent \
         active:brightness-95 \
         focus-visible:ring-info/35",

            danger:
                "bg-danger text-danger-fg border-transparent \
          active:brightness-95 \
         focus-visible:ring-danger/40",
        },
        size: {
            sm: "px-3 py-1.5 text-xs",
            md: "px-4 py-2 text-sm",
            lg: "px-5 py-2.5 text-base",
        },
        tone: {
            default: "",
            ink: "!bg-brand-ink/90  !text-brand-ink-fg   hover:!bg-brand-ink  focus-visible:!ring-brand-ink/40",
            red: "!bg-brand-red/90  !text-brand-red-fg   hover:!bg-brand-red  focus-visible:!ring-brand-red/40",
            lime: "!bg-brand-lime/90 !text-brand-lime-fg  hover:!bg-brand-lime focus-visible:!ring-brand-lime/40",
            cyan: "!bg-brand-cyan/90 !text-brand-cyan-fg  hover:!bg-brand-cyan focus-visible:!ring-brand-cyan/40",
        },
        disabled: {
            true: "disabled:brightness-25 disabled:bg-fg disabled:text-bg-dark pointer-events-none",
            false: "",
        },
    },
    { intent: "primary", size: "sm", tone: "default", disabled: "false" },
);

// Defensive coercion so undefined props don't clobber defaults
const {
    as = "button",
    intent,
    size,
    tone,
    disabled,
    class: klass,
    ...attrs
} = Astro.props;

const Tag = as;
const intentKey = intent ?? "primary";
const sizeKey = size ?? "sm";
const toneKey = tone ?? "default";
const disabledKey = String(disabled ?? false);
---

<Tag
    class={cx(
        cls({
            intent: intentKey,
            size: sizeKey,
            tone: toneKey,
            disabled: disabledKey,
        }),
        klass,
    )}
    disabled={as === "button" ? !!disabled : undefined}
    {...attrs}
>
    <slot />
</Tag>
